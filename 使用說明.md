# YDLIDAR TG30 系列 ROS 驅動安裝與使用說明

## 安裝完成確認

✅ **YDLidar-SDK** 已安裝到 `/usr/local/`
✅ **ydlidar_ros_driver** 已編譯並安裝到工作空間
✅ **TG.launch** 啟動文件已就緒

## 工作空間結構

```
/home/alex/YDLidar_ws/
├── src/
│   └── ydlidar_ros_driver/      # ROS 驅動套件
│       ├── launch/
│       │   └── TG.launch        # TG30 系列啟動文件
│       └── ...
├── build/                        # 編譯目錄
├── devel/                        # 開發環境
└── setup_env.sh                  # 環境設定腳本
```

## 使用方法

### 1. 設定環境變數

**方法一：使用環境設定腳本（推薦）**
```bash
source /home/alex/YDLidar_ws/setup_env.sh
```

**方法二：手動設定**
```bash
source /opt/ros/noetic/setup.bash
source /home/alex/YDLidar_ws/devel/setup.bash
```

**方法三：永久設定（推薦）**
```bash
echo "source /home/alex/YDLidar_ws/devel/setup.bash" >> ~/.bashrc
source ~/.bashrc
```

### 2. 連接雷達設備

確認設備連接：
```bash
ls -l /dev/ttyUSB*    # 查看 USB 串口設備
# 或
ls -l /dev/ydlidar    # 如果已設定別名
```

### 3. 啟動 TG30 系列雷達驅動

**基本啟動：**
```bash
roslaunch ydlidar_ros_driver TG.launch
```

**自訂串口啟動（如果需要修改串口）：**
```bash
roslaunch ydlidar_ros_driver TG.launch port:=/dev/ttyUSB0
```

### 4. 查看雷達數據

**查看掃描數據話題：**
```bash
rostopic echo /scan
```

**使用 RViz 可視化：**
```bash
rosrun rviz rviz
# 在 RViz 中：
# - Fixed Frame 設為: laser_frame
# - Add -> LaserScan -> Topic: /scan
```

**或使用內建的可視化啟動文件（如果有）：**
```bash
roslaunch ydlidar_ros_driver lidar_view.launch
```

## TG.launch 參數說明

TG.launch 文件位於：`src/ydlidar_ros_driver/launch/TG.launch`

### 重要參數：

| 參數名稱 | 類型 | 預設值 | 說明 |
|---------|------|--------|------|
| `port` | string | `/dev/ydlidar` | 串口設備路徑 |
| `frame_id` | string | `laser_frame` | TF 座標系名稱 |
| `baudrate` | int | `512000` | 串口波特率 |
| `lidar_type` | int | `0` | 0:TOF, 1:TRIANGLE, 2:TOF_NET |
| `frequency` | double | `10.0` | 掃描頻率 (Hz) |
| `angle_min` | double | `-180` | 最小角度 (度) |
| `angle_max` | double | `180` | 最大角度 (度) |
| `range_min` | double | `0.01` | 最小測量距離 (米) |
| `range_max` | double | `50.0` | 最大測量距離 (米) |

### 修改參數範例：

```bash
roslaunch ydlidar_ros_driver TG.launch \
  port:=/dev/ttyUSB0 \
  frequency:=12.0 \
  range_max:=30.0
```

## 發布的話題

| 話題名稱 | 類型 | 說明 |
|---------|------|------|
| `/scan` | sensor_msgs/LaserScan | 2D 雷射掃描數據 |
| `/point_cloud` | sensor_msgs/PointCloud | 2D 點雲數據 |

## 提供的服務

| 服務名稱 | 類型 | 說明 |
|---------|------|------|
| `/stop_scan` | std_srvs::Empty | 停止掃描 |
| `/start_scan` | std_srvs::Empty | 開始掃描 |

**使用服務範例：**
```bash
rosservice call /stop_scan
rosservice call /start_scan
```

## 故障排除

### 1. 找不到設備
```bash
# 檢查設備權限
sudo chmod 666 /dev/ttyUSB0

# 或創建 udev 規則（推薦）
sudo sh /home/alex/YDLidar_ws/src/ydlidar_ros_driver/startup/initenv.sh
```

### 2. 編譯錯誤
如果出現找不到 YDLidar-SDK 的錯誤，確認 SDK 已正確安裝：
```bash
pkg-config --modversion YDLIDAR_SDK
```

### 3. 串口權限問題
```bash
sudo usermod -a -G dialout $USER
# 重新登入後生效
```

## 重要提醒

1. **必須先安裝 YDLidar-SDK**：這是 ROS 驅動的依賴項，已安裝到系統
2. **使用前記得 source 環境**：確保 ROS 能找到工作空間
3. **檢查串口設備**：確認雷達連接的正確串口路徑
4. **TG30SP 型號**：如果確實是 TG30 或其變體，應該可以使用相同的 TG.launch

## 相關連結

- YDLidar-SDK: https://github.com/YDLIDAR/YDLidar-SDK
- ydlidar_ros_driver: https://github.com/YDLIDAR/ydlidar_ros_driver
- YDLidar 官方文檔: http://www.ydlidar.cn

